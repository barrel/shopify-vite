# Troubleshooting

If the suggestions here don't work, please try posting questions on [GitHub Discussions](https://github.com/barrel/shopify-vite/discussions).

## Dev Server Cross-Origin Resource Sharing (CORS)

If you're facing CORS issues while fetching assets from the Vite dev server, allow access for your custom origin using [Vite's built-in CORS configuration](https://vite.dev/config/server-options.html#server-cors). You can specify multiple origins in the `server.cors.origin` option in your vite.config.js file.

::: code-group

```js [vite.config.js]
import shopify from 'vite-plugin-shopify'

export default {
  plugins: [
    shopify()
  ],
  server: { // [!code ++]
    cors: { // [!code ++]
      origin: [ // [!code ++]
        /^https?:\/\/(?:(?:[^:]+\.)?localhost|127\.0\.0\.1|\[::1\])(?::\d+)?$/, // [!code ++]
        'https://johns-apparel.myshopify.com', // [!code ++]
        'https://johnsapparel.com' // [!code ++]
      ] // [!code ++]
    } // [!code ++]
  } // [!code ++]
}
```
:::

## How to launch the Shopify and Vite servers in parallel? {#launch-shopify-vite}

You can use [`concurrently`](https://github.com/open-cli-tools/concurrently) or [`npm-run-all`](https://github.com/mysticatea/npm-run-all) and [script commands](https://docs.npmjs.com/cli/v8/using-npm/scripts) to launch Vite and Shopify servers in parallel.

::: code-group

```json [package.json]
  "version": "0.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite", // [!code --]
    "dev": "run-p -sr \"shopify:dev -- {@}\" \"vite:dev\" --", // [!code ++]
    "deploy": "run-s \"build\" \"shopify:push -- {@}\" --", // [!code ++]
    "shopify:dev": "shopify theme dev", // [!code ++]
    "vite:dev": "vite", // [!code ++]
    "shopify:push": "shopify theme push", // [!code ++]
    "build": "vite build"
  },
  "devDependencies": {
    "npm-run-all": "^4.1.5", // [!code ++]
    "vite": "^4.2.1",
    "vite-plugin-shopify": "^2.0.2"
  }
}
```
:::

```bash
$ npm run dev -- --store johns-apparel --live-reload full-page
```

## How to cleanup the `assets/` folder?

To clean up the `assets/` folder, you can disable the default behavior of Vite emptying the
`outDir` directory on build. Instead, use the
[vite-plugin-shopify-clean](https://www.npmjs.com/package/@driver-digital/vite-plugin-shopify-clean)
plugin, built and maintained by the [Driver Digital](https://www.driver-digital.com/) engineering team, based on work done by [BAO](https://www.byassociationonly.com/).
This plugin allows you to remove only the files generated by Vite,
while preserving any code added by third-party apps in the `assets/` folder.

```bash
$ npm i -D @driver-digital/vite-plugin-shopify-clean
```

::: code-group

```js [vite.config.js]
import shopify from 'vite-plugin-shopify'
import shopifyClean from '@driver-digital/vite-plugin-shopify-clean' // [!code ++]

export default {
  build: { // [!code ++]
    emptyOutDir: false // [!code ++]
  }, // [!code ++]
  plugins: [
    shopifyClean(), // [!code ++]
    shopify()
  ]
}
```

## Use ngrok for tunneling during theme development

If you are experiencing Cloudflare tunnel errors with the Shopify Vite Plugin, you can use ngrok as a workaround.
First, create an ngrok account and install the ngrok CLI, then follow their instructions to set up your access token.
Next, run the command `ngrok http 5173` (or any other port number you prefer) and take note of the URL
provided by ngrok, which ends with `ngrok-free.app`. Keep ngrok running. Finally, configure the plugin.

::: code-group

```js [vite.config.js]
import shopify from 'vite-plugin-shopify'

export default {
  plugins: [
    shopify({
      tunnel: 'https://123abc.ngrok-free.app' // [!code ++]
    })
  ]
}
```
:::

## Chrome Local Network Access Update & Tunnel Fix

The recent CORS errors in the Shopify Theme Editor are caused by a Google Chrome security update regarding
[Local Network Access](https://chromestatus.com/feature/5152728072060928), which now blocks public websites from making requests to private local servers (localhost) to prevent security vulnerabilities.
To fix this, we recommend enabling the [`tunnel`](https://shopify-vite.barrelny.com/guide/configuration.html#tunnel) feature directly in your `vite-plugin-shopify` configuration.
Alternatively, you can use external tools like ngrok to manually expose your server. Both methods create a public HTTPS connection,
allowing the Theme Editor to bypass the restriction and correctly load your local assets.

::: code-group

```js [vite.config.js]
// https://vitejs.dev/config/
export default defineConfig({
  plugins: [shopify(), tailwindcss()], // [!code --]
  plugins: [shopify({ tunnel: true }), tailwindcss()], // [!code ++]
  server: {
    allowedHosts: ['.trycloudflare.com'], // [!code ++]
    cors: {
      origin: [
        /^https?:\/\/(?:(?:[^:]+\.)?localhost|127\.0\.0\.1|\[::1\])(?::\d+)?$/,
        /\.myshopify\.com$/
      ]
    }
  },
  build: {
    rollupOptions: {

```
:::
